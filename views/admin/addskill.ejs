<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Skills</title>
    <link rel="stylesheet" href="/stylesheets/mainmenu.css" />
    <link rel="stylesheet" href="/stylesheets/admdash.css">
    <link rel="stylesheet" href="/stylesheets/navbar.css">
    <link rel="stylesheet" href="/stylesheets/style.css">
    <link rel="stylesheet" href="/stylesheets/admin.css">
    <link rel="stylesheet" href="/stylesheets/addskill.css">
    <link href="https://fonts.googleapis.com/css?family=Poppins&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Alatsi&display=swap" rel="stylesheet" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Actor&display=swap" rel="stylesheet">
    <title><%-title%></title>
</head>

<body>
    <!-- navbar starts here  -->
    <div class="dashnav">
        <div class="logo">Event <span class="logo-2">IO</span></div>
        <div class="navend">
            <% if(loginStatus) { %>
                <div class="sub-menu-wrap">
                    <div class="dropdown">
                        <img src="/images/login-signup/profile.svg" alt="Profile Image" class="profile-img"
                            style="margin-right: 2rem;">
                        <div class="mydrop">
                            <a href="#" id="logoutLink">Logout</a>
                        </div>
                    </div>
                </div>
                <% } else { %>
                    <a href="/auth/signup" class="btn">Signup</a>
                    <a href="/auth/login" class="btn-1">Login</a>
                    <% } %>
        </div>
    </div>
    <!-- navbar ends here  -->

    <!-- hamburg starts -->
    <div class="hamburg">
        <img src="/images/burger-menu-svgrepo-com.svg" alt="">
    </div>
    <!-- hamburg ends -->
    <!-- main menu starts here -->
    <div class="main-menu inactive">
        <div class="full " id="full">
            <div class="cross">
                <img src="/images/cross-svgrepo-com.svg" alt="">
            </div>
            <p><span class="heading">Account Settings</span></p>
            <div class="list">
                <a href="/admin/dashboard">
                    <p>Dashboard</p>
                </a>
                <a href="/admin/addskills">
                    <p>Add Skills</p>
                </a>
                <a href="/admin/notification">
                    <p>Notifications</p>
                </a>
                <a href="/admin/manageEvents">
                    <p>Manage Events</p>
                </a>
            </div>
        </div>
    </div>
    <!-- main menu ends here -->

    <main>
        <section class="add-skill-section">
            <h1>Add New Skill</h1>
            <form id="addSkillForm">
                <label for="skillName">Skill Name:</label>
                <input type="text" id="skillName" required>
                <button type="submit">Add Skill</button>
            </form>
            <h2>Existing Skills</h2>
            <ul id="skillList">
                <% for(let skill of skills){  %>
                    <li>
                        <%= skill.skill %> 
                        <button type="button" onclick="deleteSkill('<%= skill.skill_id %>')">Delete</button>
                    </li>
                <% }; %>
            </ul>
        </section>
    </main>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const hamburg = document.querySelector('.hamburg');
            const mainmenu = document.querySelector('.main-menu');
            const cross = document.querySelector('.cross');

            hamburg.addEventListener('click', function () {
                hamburg.classList.add('inactive');
                mainmenu.classList.remove('inactive');
            });

            cross.addEventListener('click', function () {
                hamburg.classList.remove('inactive');
                mainmenu.classList.add('inactive');
            });

            const addSkillForm = document.getElementById('addSkillForm');
            const skillNameInput = document.getElementById('skillName');

            const fetchSkills = async () => {
                const response = await fetch('/api/skills');
                const skills = await response.json();
                renderSkills(skills);
            };

            const renderSkills = (skills) => {
                const skillList = document.getElementById('skillList');
                skillList.innerHTML = '';
                skills.forEach((skill) => {
                    if (skill.name !== null) {
                        const li = document.createElement('li');
                        li.innerHTML = `${skill.name} <button type="button" onclick="deleteSkill('${skill.id}')">Delete</button>`;
                        skillList.appendChild(li);
                    }
                });
            };

            window.deleteSkill = async (id) => {
                const response = await fetch(`/admin/skills/${id}`, {
                    method: 'DELETE'
                });
                const result = await response.json();
                if (result.message === 'Skill deleted successfully') {
                    fetchSkills();
                }
            };

            addSkillForm.addEventListener('submit', async (event) => {
                event.preventDefault();
                const newSkill = skillNameInput.value.trim();
                if (newSkill) {
                    const response = await fetch('/admin/skills', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ skillName: newSkill })
                    });
                    const result = await response.json();
                    if (result.message === 'Skill created successfully') {
                        fetchSkills();
                        skillNameInput.value = '';
                    }
                }
            });

            fetchSkills();

            const profileImg = document.querySelector('.profile-img');
            const mydrop = document.querySelector('.mydrop');

            profileImg.addEventListener('click', function () {
                mydrop.classList.toggle('show');
            });

            window.addEventListener('click', function (event) {
                if (!profileImg.contains(event.target) && !mydrop.contains(event.target)) {
                    mydrop.classList.remove('show');
                }
            });

            document.getElementById('logoutLink').addEventListener('click', function (event) {
                event.preventDefault();
                const confirmed = confirm('Are you sure you want to logout?');
                if (confirmed) {
                    window.location.href = '/auth/logout';
                }
            });
        });
    </script>
</body>

</html>
